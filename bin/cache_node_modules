CACHE_PATH=/root/cache/yarn
CURRENT_PATH=${CACHE_PATH}/${DRONE_REPO_NAME}

function is_cached() {
	file_count=$(ls ${CURRENT_PATH}/node_modules 2>/dev/null | wc -l)
	[ "$file_count" != 0 ]
}

if is_cached ; then
        echo ">>>>>>Use cached data..."
        cp ${CURRENT_PATH}/node_modules . -rf
        eval "$@"
else
        mkdir -p ${CURRENT_PATH}
        eval "$@" && \
        echo ">>>>>>Copy data to cache..." && \
        cp node_modules ${CURRENT_PATH}/ -rf
fi

